
<html>

<style type="text/css">

header {
    background-color: black;
    color: white;
    font-family: "Times New Roman", Times, serif;
    text-align: center;
    padding: 5px;

	font-family: Arial;
  	font-size: 32px;
  	color: #56a0d3;
  	text-transform: uppercase;
  	text-decoration: none;
  	font-weight: bold;    
}
	
.left_side {
	width: 720px;
  	padding-left: 70px;
  	overflow: scroll;
}

#search_row {
	vertical-align: top;
    height : 10px;

}

.right_side {
	vertical-align: top;
    overflow :auto;
}

#searchString {
	width: 200px;
  	background-color: transparent;
}

.list {
    font-family: sans-serif;
    margin: 0;
    padding: 20px 0 0;
}

.list > li {
    display: block;
    background-color: #eee;
    padding: 2px;
    box-shadow: inset 0 1px 0 #fff;
}

</style>

<script src="/js/highlight.pack.js"></script>
<script src="http://listjs.com/no-cdn/list.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<link rel="stylesheet" href="/css/styles/vs.css">


<body>

<header>Source Code Finder</header>

<table height="100%"  border="0" cellspacing="2" cellpadding="0">

	<tr id="search_row" align="left">
	    <th align="left" >Search: <input id="searchString" class="search"/></th>
	</tr>

	<tr>
		<td class="left_side" valign="top">
			<div id="left_content">
			    <ul class="list"></ul>
				</div>

			<div style="display:none;">
				<li id="filename-item">
						<ul class="filename"></ul>
			    </li>
			</div>					
		</td>
		<td class="right_side">
            <div id="fileNameHeader"></div>
			<div id="source_code">
				
			</div>
		</td>
	</tr>				

</table>
</body>

<script type="text/javascript">

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  //

var filenamesList = undefined;

$(document).ready(function() {

	var options = {
    	item: 'filename-item'
	};

	filenamesList = new List('left_content', options);	

});	

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  //

$("#searchString").on('input', function () {
    var queryStr = $("#searchString").val();
    if (queryStr === null || queryStr.length < 3) {
        $('#source_code').html("");
        filenamesList.clear()
        return;
    }
    else {
    	PostQueryRequestToServer(queryStr)
	}

});

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  //

function PostQueryRequestToServer(searchStr) {

    $.ajax({
        url: 'query/?q=' + searchStr,
        type: 'GET',
        success: function (response) {
        	var values = [];

            $.each(response, function (i, item) {
	    			values.push({ filename: item.fileName  , id : item.id, directory: item.directory});
            });

            filenamesList.clear();
            filenamesList.add(values)

			$(".filename").click(function (event) {
			    var v = filenamesList.get("filename", event.target.innerText);
			    console.log(v[0].values().id);
			    loadFile(v[0].values().id, v[0].values().filename, v[0].values().directory);
			});

        }
    });
}

// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  //

function fillFileDetails(response) {
    $('#source_code').html("<pre><code>" + (response) + "</pre></code>");
    $('pre code').each(function (i, block) 
        { hljs.highlightBlock(block);     });
    $('#fileNameHeader').html("<h4>"+ dir + "\\" + fn + "</h4>") 
}

function loadFile(id, fn, dir) {
    $.ajax({
        url: 'file/?id=' + id,
        type: 'GET',
        success: function (response) {
            fillFileDetails(response, fn, dir)
        }
    });

}


</script>

</html>